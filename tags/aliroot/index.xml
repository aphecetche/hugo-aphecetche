<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Aliroot on Laurent Aphecetche - High Energy Collisions Investigator</title>
    <link>http://aphecetche.github.io/tags/aliroot/</link>
    <description>Recent content in Aliroot on Laurent Aphecetche - High Energy Collisions Investigator</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <copyright>Laurent Aphecetche</copyright>
    <lastBuildDate>Sun, 20 Mar 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://aphecetche.github.io/tags/aliroot/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Adding LV values to the reconstruction</title>
      <link>http://aphecetche.github.io/2016/03/20/adding-lv-values-to-reco/</link>
      <pubDate>Sun, 20 Mar 2016 00:00:00 +0000</pubDate>
      
      <guid>http://aphecetche.github.io/2016/03/20/adding-lv-values-to-reco/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;https://alice.its.cern.ch/jira/browse/ALIROOT-6590&#34;&gt;JIRA&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;mapping:64dae948e49f4922a701c36690f4e4c1&#34;&gt;Mapping&lt;/h2&gt;

&lt;p&gt;The LV DCS mapping was not foreseen in the MCH mapping, so this is something that has to be added now.&lt;/p&gt;

&lt;p&gt;LV channels belong to groups. Each group has 3 voltages : -2.5, 2.5 and 3.3 Volts. Note that the DCS values themselves are always positive (i.e 2.5 , 2.5, 3.3 Volts for the 3 groups).&lt;/p&gt;

&lt;p&gt;The DCS aliases do have the form :&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;// St 1-2 have 4 LV groups

MchHvLvLeft/Chamber[01..10]Left/Group[1..4]dig
MchHvLvLeft/Chamber[01..10]Left/Group[1..4]ann
MchHvLvLeft/Chamber[01..10]Left/Group[1..4]anp
MchHvLvRight/Chamber[01..10]Right/Group[1..4]dig
MchHvLvRight/Chamber[01..10]Right/Group[1..4]ann
MchHvLvRight/Chamber[01..10]Right/Group[1..4]anp

// St3 has 5 LV groups

MchHvLvLeft/Chamber[05..06]Left/Group[5..5]dig
MchHvLvLeft/Chamber[05..06]Left/Group[5..5]ann
MchHvLvLeft/Chamber[05..06]Left/Group[5..5]anp
MchHvLvRight/Chamber[05..06]Right/Group[5..5]dig
MchHvLvRight/Chamber[05..06]Right/Group[5..5]ann
MchHvLvRight/Chamber[05..06]Right/Group[5..5]anp

// St4-5 have 7 LV groups

MchHvLvLeft/Chamber[07..10]Left/Group[5..7]dig
MchHvLvLeft/Chamber[07..10]Left/Group[5..7]ann
MchHvLvLeft/Chamber[07..10]Left/Group[5..7]anp
MchHvLvRight/Chamber[07..10]Right/Group[5..7]dig
MchHvLvRight/Chamber[07..10]Right/Group[5..7]ann
MchHvLvRight/Chamber[07..10]Right/Group[5..7]anp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;where &lt;code&gt;ann&lt;/code&gt; stands for analog negative (-2.5 V), &lt;code&gt;anp&lt;/code&gt; for analog positive (2.5 V) and &lt;code&gt;dig&lt;/code&gt; for digital (3.3 V).&lt;/p&gt;

&lt;p&gt;So we get a gran total of 324 ( = 3*108=3x(2x(4x4+2x5+4x7)) ) DCS LV aliases.&lt;/p&gt;

&lt;h2 id=&#34;ocdb:64dae948e49f4922a701c36690f4e4c1&#34;&gt;OCDB&lt;/h2&gt;

&lt;p&gt;First, while waiting to get values from Pt2 (see &lt;a href=&#34;https://alice.its.cern.ch/jira/browse/ALIDCS-540&#34;&gt;https://alice.its.cern.ch/jira/browse/ALIDCS-540&lt;/a&gt;) generate fake values
 using &lt;code&gt;AliMUONCDB&lt;/code&gt;, picking as reference run 246980 (LHC15o)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;AliMpCDB::LoadAll2();
time_t refTime = 1449969676;
AliCDBManager::Instance()-&amp;gt;SetDefaultStorage(&amp;quot;alien://folder=/alice/cern.ch/user/l/laphecet/OCDB&amp;quot;);
Bool_t defaultValue = kFALSE;
AliMUONCDB::WriteLV(defaultValue,246980,246980,refTime);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then, use the new &lt;code&gt;AliMUONTrackerLV&lt;/code&gt; class (coming from the refactoring of &lt;code&gt;AliMUONTrackerHV&lt;/code&gt;, adding the &lt;code&gt;AliMUONTrackerVoltages&lt;/code&gt; base class) to check the fake values are as expected :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;AliMpCDB::LoadAll2();
AliMUONTrackerLV lv(246980,&amp;quot;alien://folder=/alice/cern.ch/user/l/laphecet/OCDB&amp;quot;);
AliCDBManager::Instance()-&amp;gt;SetSpecificStorage(&amp;quot;GRP/GRP/Data&amp;quot;,&amp;quot;local:///cvmfs/alice-ocdb.cern.ch/calibration/data/2015/OCDB&amp;quot;);
lv.Print(&amp;quot;Chamber01&amp;quot;);
lv.Plot(&amp;quot;Chamber01&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Should printout values around 2.5 for the &lt;code&gt;ann&lt;/code&gt; groups or &lt;code&gt;anp&lt;/code&gt; groups and around 3.3 for the &lt;code&gt;dig&lt;/code&gt; groups. Note that positive and negative groups both get positive values as that&amp;rsquo;s the way it&amp;rsquo;s done in DCS.&lt;/p&gt;

&lt;p&gt;Setting a specific storage for GRP to point to a real OCDB (compared to the local one $ALICE_ROOT/OCDB) to get the run start and end time.&lt;/p&gt;

&lt;p&gt;Next step is to use &lt;code&gt;mchview&lt;/code&gt; to get the ultimate graphical view on those values&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>O2 - Creating MCH digit files from filtered RAW data</title>
      <link>http://aphecetche.github.io/2016/03/13/o2createdigitfiles/</link>
      <pubDate>Sun, 13 Mar 2016 00:00:00 +0000</pubDate>
      
      <guid>http://aphecetche.github.io/2016/03/13/o2createdigitfiles/</guid>
      <description>&lt;p&gt;First, get the code from AliRoot (feature-muonhlt) branch in MUON/MUON2 directory, and put it on SAF3&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sshfs -o ssh_command=&amp;quot;gsissh -p1975&amp;quot; nansafmaster3.in2p3.fr:/home/laphecet ~/saf3
mkdir -p $HOME/saf3/o2
cp $ALICE_ROOT/../src/MUON/MUONO2/O2Muon.* $HOME/saf3/o2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Check on SAF3 that the code is compiling under Root :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;saf3-enter
root
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;gSystem-&amp;gt;SetIncludePath(&amp;quot;-I$ALICE_ROOT/include&amp;quot;);
.L O2Muon.cxx++
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And test on a single file that the code is behaving as expected :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;echo &amp;quot;root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099032.133.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root&amp;quot; &amp;gt; input.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-c++&#34;&gt;gSystem-&amp;gt;SetIncludePath(&amp;quot;-I$ALICE_ROOT/include&amp;quot;)
.L O2Muon.cxx++
O2Muon o2m(&amp;quot;local:///cvmfs/alice-ocdb.cern.ch/calibration/data/2011/OCDB&amp;quot;);
o2m.makeDigitFiles(&amp;quot;input.txt&amp;quot;,&amp;quot;CPBI2_B1-B-NOPF-ALLNOTRD&amp;quot;,true);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then use &lt;code&gt;condor&lt;/code&gt; for the heavy lifting. Prepare a file list for a given run or part of it, in a file ending with the extension &lt;code&gt;.list&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099032.133.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root
root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099063.163.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root
root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099065.113.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root
root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099054.124.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root
root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099060.150.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root
root://nansafmaster2//alice/data/2011/LHC11h/000169099/raw/11000169099065.166.FILTER_RAWMUON_WITH_ALIPHYSICS_vAN-20150213.root
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Use the following &lt;code&gt;makedigits.condor&lt;/code&gt; file :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;universe=vanilla

executable=$ENV(HOME)/o2/makedigits/makedigits.sh

# Don&#39;t send annoying email notifications
Notification = Never

# stdout and stderr of PoD jobs
Output        = makedigits.out
Error         = makedigits.err
Log           = makedigits.log

# we want to transfer files
should_transfer_files = YES
when_to_transfer_output = ON_EXIT

rank = -SlotID

Input = $ENV(HOME)/.PoD/user_worker_env.sh

include : $ENV(HOME)/o2/makedigits/list-input.sh |
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;where the &lt;code&gt;list-input.sh&lt;/code&gt; script is generating the &lt;code&gt;queue&lt;/code&gt; commands from any file with extension &lt;code&gt;.list&lt;/code&gt;. In that file you might want to change the &lt;code&gt;ninput&lt;/code&gt; parameter which decide how many files you will process per condor job.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;
# split by chunks of n raw files
ninput=50

for file in $(ls $HOME/o2/makedigits/*.list)
do

	n=0
	index=0

	f=$(basename $file)

	mkdir -p $HOME/o2/makedigits/$f.dir

	cd $HOME/o2/makedigits/$f.dir
	rm -rf input.*

	for l in $(cat $file)
	do
		echo $l &amp;gt;&amp;gt; input.$index
		(( n += 1))
		if (( $n % $ninput == 0 ))
		then
			echo &amp;quot;transfer_input_files=\$ENV(HOME)/o2/makedigits/$f.dir/input.$index,\$ENV(HOME)/o2/O2Muon.cxx,\$ENV(HOME)/o2/O2Muon.h&amp;quot;
			echo &amp;quot;arguments = input.$index&amp;quot;
			echo &amp;quot;queue&amp;quot;
			(( index +=1 ))
			n=0
		fi
	done
done

if (( $n &amp;gt; 0 &amp;amp;&amp;amp; $n &amp;lt; $ninput ))
then
	echo &amp;quot;transfer_input_files=\$ENV(HOME)/o2/makedigits/$f.dir/input.$index,\$ENV(HOME)/o2/O2Muon.cxx,\$ENV(HOME)/o2/O2Muon.h&amp;quot;
	echo &amp;quot;arguments = input.$index&amp;quot;
	echo &amp;quot;queue&amp;quot;
fi
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And finally the script doing the job, &lt;code&gt;makedigits.sh&lt;/code&gt;, which is using the &lt;code&gt;O2Muon&lt;/code&gt; class from AliRoot/MUON/MUONo2 package.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash

source  /cvmfs/alice.cern.ch/etc/login.sh
source `which alienv` setenv VO_ALICE@AliRoot::v5-08-02-1

alienv list

echo &amp;quot;arg=$1&amp;quot;

pwd
ls -al

  root -b &amp;lt;&amp;lt; EOF
    gSystem-&amp;gt;SetIncludePath(&amp;quot;-I$ALICE_ROOT/include&amp;quot;);
    .L O2Muon.cxx++
    O2Muon o2m(&amp;quot;local:///cvmfs/alice-ocdb.cern.ch/calibration/data/2011/OCDB&amp;quot;);
    o2m.makeDigitFiles(&amp;quot;$1&amp;quot;,&amp;quot;CPBI2_B1-B-NOPF-ALLNOTRD&amp;quot;,true);
    .q
EOF
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>MCH Bus Patch Occupancy Evolution DA</title>
      <link>http://aphecetche.github.io/2015/09/08/mchbpevoda/</link>
      <pubDate>Tue, 08 Sep 2015 00:00:00 +0000</pubDate>
      
      <guid>http://aphecetche.github.io/2015/09/08/mchbpevoda/</guid>
      <description>

&lt;p&gt;In order to get a more precise idea on how the MCH occupancy is behaving, I&amp;rsquo;ve started to develop a new DA, MCHBPEVOda, that will monitoring the bus patch occupancy as a function of time. Possibly it will also issue, on regular basis, a list of &amp;ldquo;faulty&amp;rdquo; bus patches (BP with too high occupancy). In turn, that list could be used online to remove those bus patches from the configuration, on-the-fly.&lt;/p&gt;

&lt;p&gt;The (monitoring) DA decode raw data events and count the number of times each bus patch is hit, within a given time window, called the time resolution. The configuration file of the DA allows to specify the time resolution(s), which is 60 seconds by default. Every given (configurable) number of (used) events (1000 by default), that hit count is converted into the occupancy of each bus patch. That occupancy is compared to a (configurable) threshold, and a message is issued for each bus patch above the threshold.&lt;/p&gt;

&lt;h2 id=&#34;test-method:cd4fef9f33648f35415ecd8eab42359c&#34;&gt;Test method&lt;/h2&gt;

&lt;p&gt;The DA is developped with AliRoot in a SLC6 VMware Fusion 7 Pro machine on my MacBook Pro. To test it on a data sample large enough, here&amp;rsquo;s the procedure :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;modified the deroot program (&lt;a href=&#34;https://alice.its.cern.ch/jira/browse/ALIROOT-6278&#34;&gt;see JIRA ALIROOT-6278&lt;/a&gt;) to be able to read a collection of input files, instead of just one,&lt;/li&gt;
&lt;li&gt;made use of the filtering facility of the SAF2 to stage (filtered) RAW data of complete runs,&lt;/li&gt;
&lt;li&gt;create one (two, for Run1 data, i.e. data with CDH v2) FIFO pipe : mknod /tmp/deroot p (mknod /tmp/mpconvert p)&lt;/li&gt;
&lt;li&gt;in one terminal, launch the deroot program to run on a collection of files (ideally all the files of one run), and send the output to a FIFO

&lt;ul&gt;
&lt;li&gt;deroot collection://filelist.txt /tmp/deroot&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;(only for CDH v2 data), in another terminal, launch the mpconvert program to run from /tmp/deroot and send its output to the FIFO /tmp/mpconvert

&lt;ul&gt;
&lt;li&gt;/date/monitoring/Linux/mpConvert /tmp/deroot /tmp/mpconvert&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;in yet another terminal, launch the DA to read from the FIFO (either /tmp/deroot for recent data or /tmp/mpconvert for CDH v2) :

&lt;ul&gt;
&lt;li&gt;MCHBPEVOda.exe /tmp/deroot &amp;ldquo;start-date&amp;rdquo; output.root&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Note the DA, when used locally, &lt;em&gt;must&lt;/em&gt; be given the start date of the considered run to get the reference time where to start the histograms time-axis. Online, this reference time will be the start time of the DA executable. Optionally, the last parameter gives the name of the output Root file (mchbpevo.root if not given).&lt;/p&gt;

&lt;p&gt;The output file contains one AliMergeableCollection (named bpevo) containing, for each time resolution chosen, 889 histograms : 1 for hits count per bus patch + 1 for the number of events in each time bin.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;root [2] bpevo.Print(&amp;quot;*&amp;quot;)

(TH1F)     Nevents60s | Number of events 60 s bins | Entries=84002 Sum=84002

/BUSPATCH/HITS/60s/
  (TH1F)     BP0001 | Number of hits in 10 s bins | Entries=26797 Sum=63292
  (TH1F)     BP0002 | Number of hits in 10 s bins | Entries=26011 Sum=57671
  (TH1F)     BP0003 | Number of hits in 10 s bins | Entries=31095 Sum=71150
  (TH1F)     BP0004 | Number of hits in 10 s bins | Entries=39008 Sum=91357
 etc...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To ease the interpretation, the ComputeOccupancies function of the MCHBPEVOdaUtils.C macro (in $ALICE_ROOT/../src/MUON/DA), can be used to produce some more histograms. The  number of pads is put into histograms, for each detector part (bus patch, detection element, DDL, chamber, station, the last two have a left and a right version as well). For every detector part, the occupancy is then computed from the hits counts.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/BUSPATCH/HITS/60s/
/BUSPATCH/NPADS/
/BUSPATCH/OCC/60s/
/CHAMBER/HITS/60s/
/CHAMBER/NPADS/
/CHAMBER/OCC/60s/
/DDL/HITS/60s/
/DDL/NPADS/
/DDL/OCC/60s/
/DE/HITS/60s/
/DE/NPADS/
/DE/OCC/60s/
/STATION/HITS/60s/
/STATION/NPADS/
/STATION/OCC/60s/
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;some-results:cd4fef9f33648f35415ecd8eab42359c&#34;&gt;Some results&lt;/h2&gt;

&lt;h3 id=&#34;lhc15i-run-235201-31-minutes-long-run:cd4fef9f33648f35415ecd8eab42359c&#34;&gt;LHC15i : run 235201, 31 minutes-long run&lt;/h3&gt;

&lt;p&gt;First, start with a global view : the occupancy time evolution of the stations (black : full station, red : right part, blue : left part).&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aphecetche.github.io/images/lhc15i/mchbpevo-run235201-stations.png&#34; alt=&#34;Occupancy Evolution for Stations&#34; /&gt;&lt;/p&gt;

&lt;p&gt;We see that something strange happened about half-way into the run with Station3, and the occupancy of Station4 (right) is pretty high. Let&amp;rsquo;s have a closer look at their chambers.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://aphecetche.github.io/images/lhc15i/mchbpevo-run235201-station-3.png&#34; alt=&#34;Occupancy Evolution for Station 3&#34; /&gt;
&lt;img src=&#34;http://aphecetche.github.io/images/lhc15i/mchbpevo-run235201-station-4.png&#34; alt=&#34;Occupancy Evolution for Station 4&#34; /&gt;&lt;/p&gt;

&lt;p&gt;So the culprits are CH5R and CH8R. Continuing to go down, we get to the detection elements :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;DE 0517 with an occupancy around 2% and a dip in the middle of the run&lt;/li&gt;
&lt;li&gt;DE 0820 (7%), 821 (33%), 822 (9%), 823 (25%)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;and finally to the faulty bus patches&amp;hellip;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;BP1108 and 1107 with the dip&lt;/li&gt;
&lt;li&gt;BP1535 to 1544 (almost all of bottom CH8R, except for DE0824), DDL 2575&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;http://aphecetche.github.io/images/lhc15i/mchbpevo-run235201-ddl.png&#34; alt=&#34;Occupancy Evolution for DDLs&#34; /&gt;
&lt;img src=&#34;http://aphecetche.github.io/images/lhc15i/mchbpevo-run235201-bp-of-ddl2575.png&#34; alt=&#34;Occupancy Evolution for bus patches of DDL 2575&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>